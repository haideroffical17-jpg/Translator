<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <title>Free Unlimited TTS (FastAPI + Coqui)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 150px; font-size: 1rem; padding: 0.5rem; }
        .row { display: flex; gap: 1rem; margin: 0.5rem 0; }
        .row > div { flex: 1; }
        button { background: #0d6efd; color: white; border: none; padding: 0.6rem 1rem; cursor: pointer; border-radius: 4px; }
        button:disabled { opacity: .6; cursor: not-allowed; }
        .output { margin-top: 1rem; }
        .hidden { display: none; }
        .small { font-size: .9rem; color: #666; }
    </style>
</head>
<body>
<div class="container">
    <h1>Free Unlimited Text‑to‑Speech</h1>
    <p class="small">
        یہ پیج آپ کے مقامی FastAPI ٹی ٹی ایس سروس سے فالتو آواز بنا کر ڈاؤن لوڈ کرنے کی سہولت دیتا ہے۔
        (API: <code>http://127.0.0.1:8000/tts</code>)
    </p>

    <form id="tts-form">
        <label for="text">متن:</label>
        <textarea id="text" name="text" required placeholder="یہاں لکھیں…"></textarea>

        <div class="row">
            <div>
                <label for="speed">سپیڈ (0.5‑2.0):</label>
                <input type="number" id="speed" name="speed" step="0.1" min="0.5" max="2.0" value="1.0">
            </div>
            <div>
                <label for="language">زبان (اختیاری):</label>
                <input type="text" id="language" name="language" placeholder="مثال: en, es, fr">
            </div>
            <div>
                <label for="speaker">اسپیکر (اختیاری):</label>
                <input type="text" id="speaker" name="speaker" placeholder="اگر ماڈل multi‑speaker ہے">
            </div>
        </div>

        <button type="submit" id="generateBtn">آواز بنائیں</button>
        <span id="loading" class="small hidden">…پراسیسنگ… براہ کرم انتظار کریں</span>
    </form>

    <div class="output" id="output" class="hidden">
        <h3>Result:</h3>
        <audio id="player" controls class="hidden"></audio>
        <p><a id="downloadLink" href="#" download="voice.wav" class="hidden">WAV ڈاؤن لوڈ کریں</a></p>
        <p id="info" class="small"></p>
    </div>
</div>

<script>
    // ================== ترتیب ==================
    const API_URL = 'http://127.0.0.1:8000/tts';   // اگر کوئی اور ڈومین استعمال کریں تو اسے بدل دیں

    const form = document.getElementById('tts-form');
    const generateBtn = document.getElementById('generateBtn');
    const loading = document.getElementById('loading');

    const player = document.getElementById('player');
    const downloadLink = document.getElementById('downloadLink');
    const info = document.getElementById('info');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // UI کو لوڈنگ موڈ میں ڈال دیتے ہیں
        generateBtn.disabled = true;
        loading.classList.remove('hidden');
        player.classList.add('hidden');
        downloadLink.classList.add('hidden');
        info.textContent = '';

        const text = document.getElementById('text').value.trim();
        const speed = document.getElementById('speed').value || 1.0;
        const language = document.getElementById('language').value.trim();
        const speaker = document.getElementById('speaker').value.trim();

        // FormData object بناتے ہیں (multipart/form-data)
        const formData = new FormData();
        formData.append('text', text);
        formData.append('speed', speed);
        if (language) formData.append('language', language);
        if (speaker) formData.append('speaker', speaker);

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                body: formData,
                // CORS کے لیے کوئی اضافی header درکار نہیں، FastAPI CORS middleware میں "*" ہے
            });

            if (!response.ok) {
                const errText = await response.text();
                throw new Error(`Server error (${response.status}): ${errText}`);
            }

            // سروس سے آنے والا WAV فائل ہمیشہ `audio/wav` ہوتا ہے
            const blob = await response.blob();
            const objectUrl = URL.createObjectURL(blob);

            // Audio پلیئر اور ڈاؤن لوڈ لنک سیٹ کرتے ہیں
            player.src = objectUrl;
            player.classList.remove('hidden');

            // ڈاؤن لوڈ لنک میں بھی object URL دیتے ہیں
            downloadLink.href = objectUrl;
            // Random نام کی ضرورت نہیں، لیکن اگر چاہیں تو UUID بنا سکتے ہیں
            downloadLink.classList.remove('hidden');

            // معلومات (اگر چاہیں)
            const audioId = response.headers.get('X-Audio-ID') || 'N/A';
            info.textContent = `Generated audio ID: ${audioId} | Size: ${(blob.size/1024).toFixed(1)} KB`;

        } catch (err) {
            console.error(err);
            info.textContent = `غلطی: ${err.message}`;
        } finally {
            // UI واپس نرم کرتے ہیں
            generateBtn.disabled = false;
            loading.classList.add('hidden');
        }
    });
</script>
</body>
</html>
