<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Cloning Tool (Working Attempt)</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; }
        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; }
        input[type="file"], textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #5cb85c; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; width: 100%; font-size: 16px; }
        button:hover { background-color: #4cae4c; }
        #output { margin-top: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #e9e9e9; }
        .loading { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 2s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>üéôÔ∏è Awaaz Clone Karne Ka Tool</h2>
        <p><strong>NOTE:</strong> Behtar results ke liye, 6-10 seconds ki *saaf* (clear) English audio file use karein.</p>
        
        <form id="voiceCloneForm">
            <label for="referenceAudio">1. Reference Audio Upload Karein (Awaaz Ka Sample):</label>
            <input type="file" id="referenceAudio" accept="audio/*" required>
            
            <label for="inputText">2. Jo Text Bulwana Hai, Woh English Mein Likhein:</label>
            <textarea id="inputText" rows="4" placeholder="Example: Hello, this is my cloned voice speaking now." required></textarea>
            
            <button type="submit" id="generateButton">Awaaz Generate Karo</button>
        </form>

        <div id="output">
            <p><strong>Result:</strong> Generated audio yahan aayega.</p>
        </div>
    </div>

    <script>
        // Aapka diya hua Token yahan use ho raha hai:
        const API_TOKEN = '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';
        // Coqui XTTS-v2 model ka API URL:
        const MODEL_API_URL = 'https://api-inference.huggingface.co/models/coqui/XTTS-v2'; 

        // File ko Base64 mein convert karne ka function
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    // Data URL (data:audio/wav;base64,....) mein se sirf Base64 string nikalna
                    resolve(reader.result.split(',')[1]); 
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        document.getElementById('voiceCloneForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const referenceAudioFile = document.getElementById('referenceAudio').files[0];
            const inputText = document.getElementById('inputText').value;
            const outputDiv = document.getElementById('output');
            
            // Output area update karna aur Loading dikhana
            outputDiv.innerHTML = '<p><span class="loading"></span><strong>Processing...</strong> Awaaz generate ho rahi hai. Please wait (20-60 seconds lag sakte hain).</p>';
            document.getElementById('generateButton').disabled = true;

            if (!referenceAudioFile) {
                outputDiv.innerHTML = '<p style="color:red;">Reference Audio File upload karna zaroori hai.</p>';
                document.getElementById('generateButton').disabled = false;
                return;
            }

            try {
                // 1. Audio file ko Base64 string mein convert karna
                const audioDataUrl = await fileToBase64(referenceAudioFile);

                // 2. JSON Payload banana
                const payload = {
                    "text": inputText,
                    "speaker_wav": audioDataUrl, 
                    "language": "en" // XTTS-v2 English mein sabse accha kaam karta hai.
                };

                // 3. API Call karna
                const response = await fetch(
                    MODEL_API_URL,
                    {
                        headers: { 
                            "Authorization": `Bearer ${API_TOKEN}`,
                            "Content-Type": "application/json"
                        },
                        method: "POST",
                        body: JSON.stringify(payload),
                    }
                );

                document.getElementById('generateButton').disabled = false;

                if (!response.ok) {
                    const errorText = await response.text();
                    outputDiv.innerHTML = `<p style="color:red;">‚ùå API Error: ${response.status} - ${errorText || response.statusText}</p>`;
                    return;
                }

                // 4. Audio data ko blob mein badalna aur play karna
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                outputDiv.innerHTML = `
                    <p><strong>‚úÖ Success!</strong> Awaaz generate ho gayi hai.</p>
                    <audio controls src="${audioUrl}"></audio>
                `;

            } catch (error) {
                document.getElementById('generateButton').disabled = false;
                console.error("Fetch error:", error);
                outputDiv.innerHTML = `<p style="color:red;">‚ùå Network Error: Server se connect nahi ho paya ya file size bahut bada hai.</p>`;
            }
        });
    </script>

</body>
</html>
